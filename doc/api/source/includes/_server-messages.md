# 服务端 - 聊天系统
## 获取订单的聊天列表

### HTTP 请求

- GET `/v1/admin/orders/{id}/messages`

### 请求参数

| 参数名称 | 是否必须 | 类型   | 默认值 | 描述 
| ------- | ------- | ------ | ----- | -----------
| id      | true    | int    | NA    | 订单 id

> Response:

```json
{  
  "data": {
    "list": [
      {
        "id": "5454937",
        "uid": "0",// 系统消息时 uid 为 0
        "type": "system",
        "content": "created",
        "is_read": 0,
        "ctime": 1530604762277
      },
      {
        "id": "54549372",
        "uid": "1234567",// 用户id
        "type": "text",
        "content": "你好，请尽快打款",
        "is_read": 0,
        "ctime": 1530604762277
      },
      ...
    ],
    "meta": {
      "page": 1, // 当前页码
      "limit": 10,// 每页数据条数
      "total": 100, // 总个数
    }
  }
}
```

### 响应数据

| 字段名称         | 是否必须 | 类型   | 描述        | 取值范围       |
| --------------- | ------- | ------ | ---------- | ------------- |
| id              | true    | long   | 订单ID      |               |
| uid             | true    | long   | 用户ID      |               |
| type            | true    | string | 订单类型     | 见下表        |
| content         | true    | text   | 消息内容     | 见下表        |
| is_read         | true    | int    | 是否已读     | 0-未读, 1-已读 |
| ctime           | true    | long   | 订单创建时间 |               |


#### type 类型定义:

| 类型   | 描述   |
| ------ | ----- |
| system | 系统  |
| text   | 消息  |


#### 系统消息内容定义：

| 内容             | 买家                                         | 卖家                                    |
| --------------- | -------------------------------------------- | --------------------------------------- |
| submitted       | 您已成功下单，请及时付款。                      | 已成功下单，请等待买家付款。                |
| unconfirmed     | 你已付款，请等待卖家确认收款。                   | 买家已付款，请及时查收并确认收款。          |
| confirmed       | 卖家已确认收款，系统正在转账代币到您的钱包。       | 您已确认收款，系统正在转账代币到买家的钱包。 |
| finished        | 转账完成，您已收到您购买的代币。                 | 转账完成，买家已收到您出售的代币。          |
| buyer_canceled  | 您已取消订单，请不要再付款给卖家。                | 买家取消订单，如收到买家付款，请及时退还。   |
| seller_canceled | 卖家取消订单，请不要再付款给卖家。                | 您已取消订单，如收到买家付款，请及时退还。   |
| admin_canceled  | 客服取消订单，请不要再付款给卖家。                | 客服取消订单，如收到买家付款，请及时退还。   |
| pay_expired     | 您的订单因为超时已被系统取消，如有疑问，请联系客服。| 买家付款超过时间限制，订单已被系统取消。     |
| confirm_expired | 卖家确认收款时间已过期，可以通过申诉联系客服。     | 您的确认收款时间已过期，请尽快确认。         |
| buyer_appealed  | 您已成功提交申诉，请联系客服处理。               | 买家申诉，请配合客服沟通协调。              |
| seller_appealed | 卖家申诉，请配合客服沟通协调。                   | 您已成功提交申诉，请联系客服处理。          |
| buyer_appeal_resolved | 您已取消申诉，请继续完成订单。             | 买家已取消申诉，您可以继续完成订单。        |
| seller_appeal_resolved | 卖家已取消申诉，您可以继续完成订单。       | 您已取消申诉，请继续完成订单。             |

## 获取所有系统消息定义

### HTTP 请求

- GET `/v1/admin/systemmessages`

### 请求参数

| 参数名称  | 是否必须 | 类型   | 默认值 | 描述 
| -------- | ------- | ------ | ----- | -----------
| page     | false   | int    | NA    | 当前显示分页号
| per_page | false   | int    | 10    | 每页显示条数

> Response:

```json
{  
  "data": {
    "list": [
      {
        "id": "123456789",
        "key": "created",
        "buyer": "您已成功下单，请及时付款。",
        "seller": "已成功下单，请等待买家付款。",
        "admin": "已成功下单，等待买家付款。",
        "ctime": 1494901162595,
        "utime": 1494901162595,
        "dtime": 0,
      },
      {
        "id": "123456790",
        "key": "unconfirmed",
        "buyer": "你已付款，请等待卖家确认收款。",
        "seller": "买家已付款，请及时查收并确认收款。",
        "admin": "已成功下单，等待买家付款。",
        "ctime": 1494901162595,
        "utime": 1494901162595,
        "dtime": 0,
      }
    ],
    "meta": {
      "page": 1, // 当前页码
      "limit": 10,// 每页数据条数
      "total": 100, // 总个数
    }
  }
}
```

## 获取系统消息定义

### HTTP 请求

- GET `/v1/admin/systemmessages/{id}`

### 请求参数

| 参数名称 | 是否必须 | 类型   | 默认值 | 描述 
| ------- | ------- | ------ | ----- | -----------
| id      | true    | int    | NA    | 系统消息 id

> Response:

```json
{  
  "data": {
    "id": "123456789",
    "key": "created",
    "buyer": "您已成功下单，请及时付款。",
    "seller": "已成功下单，请等待买家付款。",
    "admin": "已成功下单，等待买家付款。",
    "ctime": 1494901162595,
    "utime": 1494901162595,
    "dtime": 0,
  }
}
```

### 响应数据

| 字段名称   | 是否必须 | 类型   | 描述         | 取值范围 |
| -------- | ------- | ------ | ---------- | ------- |
| id       | true    | long   | 系统消息 ID |         |
| key      | true    | string | 系统消息标识 |         |
| buyer    | true    | string | 买家显示内容 |         |
| seller   | true    | string | 卖家显示内容 |         |
| admin    | true    | string | 管理显示内容 |         |
| ctime    | false   | long   | 创建时间    |         |
| utime    | false   | long   | 更新时间    |         |
| dtime    | false   | long   | 被删时间    |         |

## 创建系统消息定义

### HTTP 请求

- POST `/v1/admin/systemmessages`

```json
{
  "key": "created",
  "buyer": "您已成功下单，请及时付款。",
  "seller": "已成功下单，请等待买家付款。",
  "admin": "已成功下单，等待买家付款。",
}
```

### 请求参数

| 参数名称   | 是否必须 | 类型   | 默认值 | 描述 
| --------- | ------- | ------ | ------ | -----------
| key       | true    | string |        | 系统消息标识
| buyer     | true    | string |        | 买家显示内容 
| seller    | true    | string |        | 卖家显示内容 
| admin     | true    | string |        | 管理显示内容 

> Response:

```json
{  
  "data": {
    "id": "123456789",
    "key": "created",
    "buyer": "您已成功下单，请及时付款。",
    "seller": "已成功下单，请等待买家付款。",
    "admin": "已成功下单，等待买家付款。",
    "ctime": 1494901162595,
    "utime": 1494901162595,
    "dtime": 0,
  }
}
```

### 响应数据
返回的主数据对象是一个对应系统消息完整对象。

## 更新系统消息定义

### HTTP 请求

- PUT `/v1/admin/systemmessages/{id}`

```json
{
  "key": "created",
  "buyer": "您已成功下单，请及时付款。",
  "seller": "已成功下单，请等待买家付款。",
  "admin": "已成功下单，等待买家付款。",
}
```

### 请求参数

| 参数名称   | 是否必须 | 类型   | 默认值 | 描述 
| --------- | ------- | ------ | ------ | -----------
| key       | true    | string |        | 系统消息标识
| buyer     | true    | string |        | 买家显示内容 
| seller    | true    | string |        | 卖家显示内容 
| admin     | true    | string |        | 管理显示内容 

> Response:

```json
{  
  "data": {
    "id": "123456789",
    "key": "created",
    "buyer": "您已成功下单，请及时付款。",
    "seller": "已成功下单，请等待买家付款。",
    "admin": "已成功下单，等待买家付款。",
    "ctime": 1494901162595,
    "utime": 1494901162595,
    "dtime": 0
  }
}
```

### 响应数据
返回的主数据对象是一个对应系统消息完整对象。

## 删除系统消息定义

### HTTP 请求

- DELETE `/v1/admin/systemmessages/{id}`

### 请求参数

| 参数名称 | 是否必须 | 类型   | 默认值 | 描述 
| ------- | ------- | ------ | ----- | -----------
| id      | true    | long   | NA    | 系统消息 id

> Response:

```json
{  
  "data": {
    "id": "123456789"
  }
}
```

### 响应数据

返回的主数据对象是一个对应系统消息id的字符串。